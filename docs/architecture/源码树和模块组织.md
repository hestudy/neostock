# 源码树和模块组织

## 项目结构（实际）

```text
neostock/
├── apps/
│   ├── server/                 # 后端 Hono 应用
│   │   ├── src/
│   │   │   ├── index.ts        # 应用入口点
│   │   │   ├── lib/
│   │   │   │   ├── auth.ts     # Better Auth 配置
│   │   │   │   ├── context.ts  # tRPC 上下文创建
│   │   │   │   ├── trpc.ts     # tRPC 实例和中间件
│   │   │   │   ├── env.ts      # 环境变量管理
│   │   │   │   ├── disaster-recovery.ts # 灾难恢复管理
│   │   │   │   ├── infrastructure.ts    # 基础设施即代码
│   │   │   │   ├── monitoring.ts        # 系统监控
│   │   │   │   ├── security.ts          # 安全管理
│   │   │   │   └── seed-data.ts         # 种子数据管理
│   │   │   ├── routers/
│   │   │   │   └── index.ts    # 主 tRPC 路由
│   │   │   ├── scripts/        # 自动化脚本
│   │   │   │   ├── check-api-changes.ts  # API变更检查
│   │   │   │   ├── pre-deploy.ts         # 部署前检查
│   │   │   │   ├── quality-gate.ts      # 质量门控
│   │   │   │   ├── security-gate.ts     # 安全门控
│   │   │   │   └── validate-docs.ts     # 文档验证
│   │   │   ├── mocks/          # 测试模拟
│   │   │   │   └── tushare-api-mock.ts  # Tushare API模拟
│   │   │   ├── openapi/        # OpenAPI集成
│   │   │   │   └── handler.ts           # OpenAPI处理器
│   │   │   ├── __tests__/      # 测试文件
│   │   │   │   ├── lib/        # 库函数测试
│   │   │   │   ├── mocks/      # 模拟测试
│   │   │   │   ├── openapi/    # OpenAPI测试
│   │   │   │   ├── routers/    # 路由测试
│   │   │   │   └── db/         # 数据库测试
│   │   │   └── db/
│   │   │       ├── index.ts    # 数据库连接
│   │   │       ├── migrations/ # 数据库迁移
│   │   │       │   └── migrator.ts      # 迁移管理器
│   │   │       └── schema/
│   │   │           └── auth.ts # Better Auth 表结构
│   │   ├── drizzle.config.ts   # Drizzle Kit 配置
│   │   ├── QUALITY_ASSURANCE.md # 质量保证文档
│   │   └── package.json
│   └── web/                    # 前端 React 应用
│       ├── src/
│       │   ├── main.tsx        # 应用入口
│       │   ├── components/     # React 组件
│       │   │   ├── ui/         # shadcn/ui 组件
│       │   │   ├── header.tsx  # 导航头部
│       │   │   └── ...         # 其他组件
│       │   ├── routes/         # TanStack Router 路由
│       │   │   ├── __root.tsx  # 根路由组件
│       │   │   ├── index.tsx   # 首页
│       │   │   ├── dashboard.tsx # 仪表板
│       │   │   └── login.tsx   # 登录页
│       │   ├── utils/
│       │   │   └── trpc.ts     # tRPC 客户端配置
│       │   └── index.css       # 全局样式
│       ├── vite.config.ts      # Vite 配置
│       └── package.json
├── web-bundles/                # BMAD 代理配置（不相关）
├── turbo.json                  # Turborepo 配置
├── package.json                # 根包配置
└── README.md
```

## 关键模块及其用途

### 核心系统模块
- **认证系统**: `apps/server/src/lib/auth.ts` - 使用 Better Auth，支持邮箱密码认证
- **API 层**: `apps/server/src/routers/index.ts` - tRPC 路由和健康检查
- **数据库**: `apps/server/src/db/` - 使用 Drizzle ORM 和 SQLite/Turso
- **环境管理**: `apps/server/src/lib/env.ts` - 环境变量验证和配置

### 基础设施模块
- **灾难恢复**: `apps/server/src/lib/disaster-recovery.ts` - 备份恢复系统，RTO<1小时
- **监控系统**: `apps/server/src/lib/monitoring.ts` - 健康检查、性能监控、告警
- **安全管理**: `apps/server/src/lib/security.ts` - API密钥管理、安全扫描
- **基础设施即代码**: `apps/server/src/lib/infrastructure.ts` - 环境配置、一键部署
- **种子数据**: `apps/server/src/lib/seed-data.ts` - A股基础数据管理

### 自动化脚本
- **质量门控**: `apps/server/src/scripts/quality-gate.ts` - 代码质量检查
- **安全门控**: `apps/server/src/scripts/security-gate.ts` - 安全漏洞扫描  
- **文档验证**: `apps/server/src/scripts/validate-docs.ts` - 文档一致性检查
- **API变更检查**: `apps/server/src/scripts/check-api-changes.ts` - API兼容性验证
- **部署前检查**: `apps/server/src/scripts/pre-deploy.ts` - 部署前自动化验证

### 测试基础设施
- **单元测试**: `apps/server/src/__tests__/lib/` - 所有核心模块的单元测试
- **集成测试**: `apps/server/src/__tests__/routers/` - API集成测试
- **Mock系统**: `apps/server/src/mocks/` - 外部API模拟服务
- **E2E测试**: `tests/e2e/` - 端到端用户流程测试

### 前端架构
- **前端路由**: `apps/web/src/routes/` - 基于文件的路由系统
- **UI 组件**: `apps/web/src/components/` - shadcn/ui 组件和自定义组件
- **状态管理**: `apps/web/src/utils/trpc.ts` - tRPC + TanStack Query 集成
- **主题系统**: `apps/web/src/components/theme-provider.tsx` - 深色/浅色主题
