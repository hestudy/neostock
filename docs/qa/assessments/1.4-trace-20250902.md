# Requirements Traceability Matrix

## Story: 1.4 - K 线图表和技术指标可视化

### Coverage Summary

- Total Requirements: 5
- Fully Covered: 0 (0%)
- Partially Covered: 0 (0%)
- Not Covered: 5 (100%)

### Requirement Mappings

#### AC1: 集成轻量级图表库实现 K 线图展示

**Coverage: NONE**

**Requirement**: 选择并集成适合的轻量级图表库，实现蜡烛图（K线）基础展示功能，支持开高低收价格数据可视化，确保图表渲染性能良好，包体积控制在合理范围内

**Test Mappings**: 无测试覆盖

**Gap**: 缺少图表库集成和K线图基础渲染测试

**Suggested Tests**:
- 图表库选择评估测试
- K线图数据渲染测试
- 图表性能基准测试
- Bundle大小验证测试

#### AC2: 支持多种技术指标叠加显示（MA、MACD、RSI 等）

**Coverage: NONE**

**Requirement**: 实现移动平均线（MA5、MA10、MA20、MA60）技术指标，支持 MACD 指标（DIF、DEA、柱状图）叠加显示，集成 RSI 相对强弱指标，提供技术指标的显示/隐藏切换功能

**Test Mappings**: 无测试覆盖

**Gap**: 缺少技术指标计算和显示功能测试

**Suggested Tests**:
- MA移动平均线计算准确性测试
- MACD指标计算和显示测试
- RSI相对强弱指标测试
- 技术指标显示/隐藏切换测试
- 多指标叠加显示性能测试

#### AC3: 实现图表的缩放、平移等交互功能

**Coverage: NONE**

**Requirement**: 支持鼠标滚轮缩放时间轴，实现图表水平拖拽平移查看历史数据，提供十字光标显示精确价格和时间信息，支持双击重置视图到默认状态

**Test Mappings**: 无测试覆盖

**Gap**: 缺少图表交互功能测试

**Suggested Tests**:
- 鼠标滚轮缩放功能测试
- 图表拖拽平移测试
- 十字光标显示测试
- 双击重置视图测试
- 交互响应时间测试

#### AC4: 优化移动端图表显示和触屏操作体验

**Coverage: NONE**

**Requirement**: 适配移动端屏幕尺寸，实现触摸手势支持（缩放、平移），优化图表在移动设备上的性能表现，确保移动端操作流畅不卡顿

**Test Mappings**: 无测试覆盖

**Gap**: 缺少移动端适配和触摸交互测试

**Suggested Tests**:
- 移动端屏幕适配测试
- 触摸手势识别测试
- 移动端性能优化测试
- 移动端操作流畅度测试
- 响应式布局测试

#### AC5: 保持与现有 UI 主题和颜色系统的一致性

**Coverage: NONE**

**Requirement**: 图表颜色与现有深色/浅色主题自动同步，保持与 shadcn/ui 组件的设计风格一致，支持用户主题切换时图表颜色自动更新

**Test Mappings**: 无测试覆盖

**Gap**: 缺少主题系统集成测试

**Suggested Tests**:
- 深色/浅色主题切换测试
- 图表颜色同步测试
- 主题配置应用测试
- shadcn/ui设计风格一致性测试

### Critical Gaps

1. **图表基础功能缺失**
   - Gap: 完全没有图表相关测试
   - Risk: High - 核心业务功能无法保证质量
   - Action: 立即创建图表组件测试套件

2. **技术指标计算未验证**
   - Gap: MA、MACD、RSI 计算准确性无测试
   - Risk: High - 金融数据计算错误会导致用户错误决策
   - Action: 实现技术指标计算单元测试

3. **交互功能无保障**
   - Gap: 缩放、平移、十字光标等交互功能无测试
   - Risk: Medium - 用户体验无法保证
   - Action: 创建交互功能测试

4. **移动端适配未测试**
   - Gap: 移动端触摸操作和性能无测试
   - Risk: Medium - 移动用户体验无法保证
   - Action: 添加移动端专项测试

5. **性能指标未验证**
   - Gap: 图表渲染性能、Bundle大小等NFR无测试
   - Risk: High - 性能不达标影响用户体验
   - Action: 实现性能基准测试

### Test Design Recommendations

基于缺口分析，建议按以下优先级创建测试：

#### P0 - 关键测试（必须立即实现）
1. **K线图基础渲染测试**
   - 测试开高低收数据正确显示
   - 验证图表初始化和销毁
   - 测试空数据和异常数据处理

2. **技术指标计算测试**
   - MA移动平均线计算准确性
   - MACD指标计算验证
   - RSI相对强弱指标计算

3. **性能基准测试**
   - 图表渲染性能（<100ms）
   - 大数据量处理能力（1000+数据点）
   - Bundle大小验证（<150KB）

#### P1 - 重要测试（短期内实现）
4. **交互功能测试**
   - 缩放、平移功能测试
   - 十字光标显示测试
   - 双击重置功能测试

5. **移动端测试**
   - 触摸手势测试
   - 响应式布局测试
   - 移动端性能测试

#### P2 - 补充测试（后续完善）
6. **主题系统集成测试**
   - 深色/浅色主题切换
   - 颜色同步测试
   - 自定义主题配置

7. **集成测试**
   - 图表与股票详情页集成
   - 实时数据更新测试
   - 端到端用户流程测试

### Risk Assessment

- **High Risk**: AC1、AC2 - 核心图表功能和技术指标计算
- **Medium Risk**: AC3、AC4 - 交互功能和移动端适配
- **Low Risk**: AC5 - 主题系统集成（相对简单）

### Next Steps

1. 立即创建 P0 级别的关键测试
2. 建立 CI/CD 中的质量门控
3. 实现测试覆盖率监控
4. 定期执行性能基准测试
5. 建立移动端专项测试流程