# neostock Brownfield Architecture Document

## ä»‹ç»

æœ¬æ–‡æ¡£è®°å½•äº† neostock é¡¹ç›®çš„å½“å‰çŠ¶æ€ï¼ŒåŒ…æ‹¬æŠ€æœ¯å€ºåŠ¡ã€å·¥ä½œæµç¨‹å’Œå®é™…æ¨¡å¼ã€‚å®ƒä½œä¸º AI ä»£ç†åœ¨å¢å¼ºåŠŸèƒ½æ—¶çš„å‚è€ƒï¼Œç‰¹åˆ«æ˜¯ä¸ºä¸­å›½è‚¡ç¥¨åˆ†æå¹³å°å¼€å‘æä¾›æŒ‡å¯¼ã€‚

### æ–‡æ¡£èŒƒå›´

åŸºäº PRD è¦æ±‚ï¼Œé‡ç‚¹å…³æ³¨ä¸ä¸­å›½è‚¡ç¥¨åˆ†æå¹³å°å¼€å‘ç›¸å…³çš„åŒºåŸŸï¼šæ•°æ®ç®¡ç†ã€API æ‰©å±•ã€å‰ç«¯ç»„ä»¶é›†æˆå’Œç”¨æˆ·æƒé™ç³»ç»Ÿã€‚

### å˜æ›´æ—¥å¿—

| æ—¥æœŸ | ç‰ˆæœ¬ | æè¿° | ä½œè€… |
|------|------|------|------|
| 2025-08-21 | 1.0 | åˆå§‹ brownfield åˆ†æï¼Œé’ˆå¯¹è‚¡ç¥¨åˆ†æå¹³å°å¢å¼º | AI åˆ†æå¸ˆ |

## å¿«é€Ÿå‚è€ƒ - å…³é”®æ–‡ä»¶å’Œå…¥å£ç‚¹

### ç†è§£ç³»ç»Ÿçš„å…³é”®æ–‡ä»¶

- **æœåŠ¡å™¨å…¥å£**: `apps/server/src/index.ts` - Hono åº”ç”¨ä¸»å…¥å£
- **å®¢æˆ·ç«¯å…¥å£**: `apps/web/src/main.tsx` - React åº”ç”¨å¯åŠ¨
- **é…ç½®æ–‡ä»¶**: 
  - `apps/server/.env.example` - æœåŠ¡å™¨ç¯å¢ƒå˜é‡æ¨¡æ¿
  - `apps/web/.env.example` - å®¢æˆ·ç«¯ç¯å¢ƒå˜é‡æ¨¡æ¿
  - `turbo.json` - Turborepo æ„å»ºé…ç½®
- **æ ¸å¿ƒä¸šåŠ¡é€»è¾‘**: 
  - `apps/server/src/routers/index.ts` - tRPC è·¯ç”±å®šä¹‰
  - `apps/server/src/lib/auth.ts` - Better Auth é…ç½®
- **æ•°æ®åº“æ¨¡å‹**: `apps/server/src/db/schema/auth.ts` - è®¤è¯ç›¸å…³è¡¨ç»“æ„
- **API ç±»å‹å®šä¹‰**: `apps/server/src/routers/index.ts` - AppRouter ç±»å‹å¯¼å‡º
- **å‰ç«¯è·¯ç”±**: `apps/web/src/routes/` - TanStack Router æ–‡ä»¶è·¯ç”±

### PRD å¢å¼ºå½±å“åŒºåŸŸ

æ ¹æ®ä¸­å›½è‚¡ç¥¨åˆ†æå¹³å° PRDï¼Œä»¥ä¸‹æ–‡ä»¶/æ¨¡å—å°†å—åˆ°å½±å“ï¼š

**æ•°æ®åº“ Schema æ‰©å±•**:
- `apps/server/src/db/schema/` - éœ€è¦æ–°å¢è‚¡ç¥¨ã€ç­–ç•¥ã€å›æµ‹ç›¸å…³è¡¨
- `apps/server/drizzle.config.ts` - æ•°æ®åº“é…ç½®

**API è·¯ç”±æ‰©å±•**:
- `apps/server/src/routers/index.ts` - éœ€è¦æ·»åŠ è‚¡ç¥¨ã€å›æµ‹ã€AI åˆ†æè·¯ç”±
- æ–°å¢ `apps/server/src/routers/stocks.ts` - è‚¡ç¥¨æ•°æ® API
- æ–°å¢ `apps/server/src/routers/backtest.ts` - å›æµ‹ API
- æ–°å¢ `apps/server/src/routers/ai.ts` - AI åˆ†æ API

**å‰ç«¯é¡µé¢**:
- `apps/web/src/routes/dashboard.tsx` - æ‰©å±•ä¸ºè‚¡ç¥¨åˆ†ææ§åˆ¶å°
- æ–°å¢ `apps/web/src/routes/stocks/` - è‚¡ç¥¨ç›¸å…³é¡µé¢ç›®å½•
- æ–°å¢ `apps/web/src/routes/backtest/` - å›æµ‹ç›¸å…³é¡µé¢ç›®å½•

## é«˜çº§æ¶æ„

### æŠ€æœ¯æ¦‚è¦

neostock æ˜¯ä¸€ä¸ªåŸºäº Better-T-Stack çš„ç°ä»£ TypeScript monorepoï¼Œä½¿ç”¨ Turborepo ç®¡ç†æ„å»ºï¼ŒBun ä½œä¸ºè¿è¡Œæ—¶ã€‚é¡¹ç›®é‡‡ç”¨ç±»å‹å®‰å…¨çš„å…¨æ ˆæ¶æ„ï¼Œå‰åç«¯é€šè¿‡ tRPC å®ç°ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨çš„ API é€šä¿¡ã€‚

### å®é™…æŠ€æœ¯æ ˆï¼ˆæ¥è‡ª package.jsonï¼‰

| ç±»åˆ« | æŠ€æœ¯ | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|------|
| è¿è¡Œæ—¶ | Bun | 1.2.18 | JavaScript/TypeScript è¿è¡Œæ—¶ï¼ŒåŒ…ç®¡ç†å™¨ |
| æ„å»ºç³»ç»Ÿ | Turborepo | 2.5.4 | Monorepo æ„å»ºå’Œç¼“å­˜ç®¡ç† |
| åç«¯æ¡†æ¶ | Hono | 4.8.2 | è½»é‡çº§ Web æ¡†æ¶ |
| API å±‚ | tRPC | 11.4.2 | ç«¯åˆ°ç«¯ç±»å‹å®‰å…¨ API |
| æ•°æ®åº“ | SQLite/Turso | - | é€šè¿‡ Drizzle ORM ç®¡ç† |
| ORM | Drizzle | 0.44.2 | TypeScript-first ORM |
| è®¤è¯ | Better Auth | 1.3.4 | ç°ä»£è®¤è¯è§£å†³æ–¹æ¡ˆ |
| å‰ç«¯æ¡†æ¶ | React | 19.0.0 | ç”¨æˆ·ç•Œé¢åº“ |
| è·¯ç”± | TanStack Router | 1.114.25 | ç±»å‹å®‰å…¨çš„æ–‡ä»¶è·¯ç”± |
| çŠ¶æ€ç®¡ç† | TanStack Query | 5.80.5 | æœåŠ¡å™¨çŠ¶æ€ç®¡ç† |
| UI ç»„ä»¶ | shadcn/ui | - | åŸºäº Radix UI çš„ç»„ä»¶åº“ |
| æ ·å¼ | TailwindCSS | 4.0.15 | å®ç”¨ä¼˜å…ˆçš„ CSS æ¡†æ¶ |
| æ„å»ºå·¥å…· | Vite | 6.2.2 | å‰ç«¯æ„å»ºå·¥å…· |

### ä»“åº“ç»“æ„ç°çŠ¶

- **ç±»å‹**: Monorepoï¼ˆä½¿ç”¨ Turborepoï¼‰
- **åŒ…ç®¡ç†å™¨**: Bunï¼ˆé€šè¿‡ packageManager å­—æ®µæŒ‡å®šï¼‰
- **å·¥ä½œç©ºé—´**: `apps/*` å’Œ `packages/*`ï¼ˆå½“å‰åªæœ‰ appsï¼‰

## æºç æ ‘å’Œæ¨¡å—ç»„ç»‡

### é¡¹ç›®ç»“æ„ï¼ˆå®é™…ï¼‰

```text
neostock/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ server/                 # åç«¯ Hono åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts        # åº”ç”¨å…¥å£ç‚¹
â”‚   â”‚   â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts     # Better Auth é…ç½®
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ context.ts  # tRPC ä¸Šä¸‹æ–‡åˆ›å»º
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ trpc.ts     # tRPC å®ä¾‹å’Œä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.ts    # ä¸» tRPC è·¯ç”±ï¼ˆç›®å‰åªæœ‰å¥åº·æ£€æŸ¥ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ db/
â”‚   â”‚   â”‚       â”œâ”€â”€ index.ts    # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”‚       â””â”€â”€ schema/
â”‚   â”‚   â”‚           â””â”€â”€ auth.ts # Better Auth è¡¨ç»“æ„
â”‚   â”‚   â”œâ”€â”€ drizzle.config.ts   # Drizzle Kit é…ç½®
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ web/                    # å‰ç«¯ React åº”ç”¨
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ main.tsx        # åº”ç”¨å…¥å£
â”‚       â”‚   â”œâ”€â”€ components/     # React ç»„ä»¶
â”‚       â”‚   â”‚   â”œâ”€â”€ ui/         # shadcn/ui ç»„ä»¶
â”‚       â”‚   â”‚   â”œâ”€â”€ header.tsx  # å¯¼èˆªå¤´éƒ¨
â”‚       â”‚   â”‚   â””â”€â”€ ...         # å…¶ä»–ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ routes/         # TanStack Router è·¯ç”±
â”‚       â”‚   â”‚   â”œâ”€â”€ __root.tsx  # æ ¹è·¯ç”±ç»„ä»¶
â”‚       â”‚   â”‚   â”œâ”€â”€ index.tsx   # é¦–é¡µ
â”‚       â”‚   â”‚   â”œâ”€â”€ dashboard.tsx # ä»ªè¡¨æ¿
â”‚       â”‚   â”‚   â””â”€â”€ login.tsx   # ç™»å½•é¡µ
â”‚       â”‚   â”œâ”€â”€ utils/
â”‚       â”‚   â”‚   â””â”€â”€ trpc.ts     # tRPC å®¢æˆ·ç«¯é…ç½®
â”‚       â”‚   â””â”€â”€ index.css       # å…¨å±€æ ·å¼
â”‚       â”œâ”€â”€ vite.config.ts      # Vite é…ç½®
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ web-bundles/                # BMAD ä»£ç†é…ç½®ï¼ˆä¸ç›¸å…³ï¼‰
â”œâ”€â”€ turbo.json                  # Turborepo é…ç½®
â”œâ”€â”€ package.json                # æ ¹åŒ…é…ç½®
â””â”€â”€ README.md
```

### å…³é”®æ¨¡å—åŠå…¶ç”¨é€”

- **è®¤è¯ç³»ç»Ÿ**: `apps/server/src/lib/auth.ts` - ä½¿ç”¨ Better Authï¼Œæ”¯æŒé‚®ç®±å¯†ç è®¤è¯
- **API å±‚**: `apps/server/src/routers/index.ts` - ç›®å‰åªæœ‰å¥åº·æ£€æŸ¥å’Œç§æœ‰æ•°æ®ç¤ºä¾‹
- **æ•°æ®åº“**: `apps/server/src/db/` - ä½¿ç”¨ Drizzle ORM å’Œ SQLite/Turso
- **å‰ç«¯è·¯ç”±**: `apps/web/src/routes/` - åŸºäºæ–‡ä»¶çš„è·¯ç”±ç³»ç»Ÿ
- **UI ç»„ä»¶**: `apps/web/src/components/` - shadcn/ui ç»„ä»¶å’Œè‡ªå®šä¹‰ç»„ä»¶
- **çŠ¶æ€ç®¡ç†**: `apps/web/src/utils/trpc.ts` - tRPC + TanStack Query é›†æˆ

## æ•°æ®æ¨¡å‹å’Œ API

### æ•°æ®æ¨¡å‹

å½“å‰æ•°æ®æ¨¡å‹ä»…åŒ…å«è®¤è¯ç›¸å…³è¡¨ï¼Œä½äº `apps/server/src/db/schema/auth.ts`:

- **user è¡¨**: ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆid, name, email, emailVerified, image, createdAt, updatedAtï¼‰
- **session è¡¨**: ç”¨æˆ·ä¼šè¯ï¼ˆid, expiresAt, token, userId, ipAddress, userAgentï¼‰
- **account è¡¨**: ç¬¬ä¸‰æ–¹è´¦æˆ·å…³è”ï¼ˆæ”¯æŒå¤šç§è®¤è¯æä¾›å•†ï¼‰
- **verification è¡¨**: éªŒè¯ç å’Œä»¤ç‰Œç®¡ç†

### API è§„èŒƒ

å½“å‰ API éå¸¸ç®€å•ï¼Œä½äº `apps/server/src/routers/index.ts`:

- **healthCheck**: å…¬å¼€çš„å¥åº·æ£€æŸ¥ç«¯ç‚¹
- **privateData**: éœ€è¦è®¤è¯çš„ç¤ºä¾‹ç«¯ç‚¹ï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯

**ç±»å‹å®‰å…¨**: é€šè¿‡ `AppRouter` ç±»å‹å¯¼å‡ºï¼Œå‰ç«¯è‡ªåŠ¨è·å¾—å®Œæ•´ç±»å‹æ”¯æŒ

## æŠ€æœ¯å€ºåŠ¡å’Œå·²çŸ¥é—®é¢˜

### å½“å‰ç³»ç»ŸçŠ¶æ€

**ä¼˜ç‚¹**:
- ğŸŸ¢ å®Œæ•´çš„ TypeScript ç±»å‹å®‰å…¨
- ğŸŸ¢ ç°ä»£åŒ–çš„æŠ€æœ¯æ ˆé€‰æ‹©
- ğŸŸ¢ æ¸…æ™°çš„ monorepo ç»“æ„
- ğŸŸ¢ è‰¯å¥½çš„å¼€å‘ä½“éªŒé…ç½®ï¼ˆçƒ­é‡è½½ã€DevToolsï¼‰

**éœ€è¦æ³¨æ„çš„é™åˆ¶**:
- ğŸŸ¡ **æœ€å°åŒ– API**: ç›®å‰åªæœ‰æ¼”ç¤ºæ€§è´¨çš„ API ç«¯ç‚¹
- ğŸŸ¡ **SQLite é™åˆ¶**: å¯¹äºä¸‡äººçº§å¹¶å‘å¯èƒ½éœ€è¦è€ƒè™‘æ‰©å±•æ€§
- ğŸŸ¡ **ç¼ºå°‘æ•°æ®åº“è¿ç§»**: ç›®å‰æ²¡æœ‰ç”Ÿæˆçš„è¿ç§»æ–‡ä»¶
- ğŸŸ¡ **ç¯å¢ƒé…ç½®**: éœ€è¦æ‰‹åŠ¨è®¾ç½®å¤šä¸ªç¯å¢ƒå˜é‡

### æ¶æ„çº¦æŸ

- **æ•°æ®åº“**: ä½¿ç”¨ SQLite/Tursoï¼Œå¯¹äºé‡‘èæ•°æ®çš„å¹¶å‘å†™å…¥èƒ½åŠ›æœ‰é™åˆ¶
- **è®¤è¯**: ä½¿ç”¨ Better Auth çš„ SQLite é€‚é…å™¨ï¼Œæ‰©å±•è®¢é˜…åŠŸèƒ½éœ€è¦é¢å¤–å¼€å‘
- **æ„å»º**: Turborepo ç¼“å­˜æœºåˆ¶å¯¹äºé¢‘ç¹å˜æ›´çš„é‡‘èæ•°æ®å¤„ç†å¯èƒ½éœ€è¦è°ƒæ•´

## é›†æˆç‚¹å’Œå¤–éƒ¨ä¾èµ–

### å½“å‰é›†æˆ

| æœåŠ¡ | ç”¨é€” | é›†æˆç±»å‹ | å…³é”®æ–‡ä»¶ |
|------|------|----------|----------|
| Better Auth | ç”¨æˆ·è®¤è¯ | å†…ç½®åº“ | `apps/server/src/lib/auth.ts` |
| Turso | æ•°æ®åº“ | SQLite å…¼å®¹ | `apps/server/drizzle.config.ts` |

### å†…éƒ¨é›†æˆç‚¹

- **å‰åç«¯é€šä¿¡**: tRPC over HTTPï¼Œç«¯å£ 3000ï¼ˆæœåŠ¡å™¨ï¼‰åˆ° 3001ï¼ˆå®¢æˆ·ç«¯ï¼‰
- **è®¤è¯æµ**: Better Auth é€šè¿‡ `/api/auth/**` è·¯å¾„å¤„ç†
- **ç±»å‹å…±äº«**: `AppRouter` ç±»å‹ä»æœåŠ¡å™¨å¯¼å…¥åˆ°å®¢æˆ·ç«¯

## å¼€å‘å’Œéƒ¨ç½²

### æœ¬åœ°å¼€å‘è®¾ç½®

```bash
# å®‰è£…ä¾èµ–
bun install

# å¯åŠ¨å¼€å‘ç¯å¢ƒï¼ˆå¹¶è¡Œå¯åŠ¨å‰åç«¯ï¼‰
bun dev

# ä»…å¯åŠ¨ç‰¹å®šåº”ç”¨
bun dev:web    # å‰ç«¯ (ç«¯å£ 3001)
bun dev:server # åç«¯ (ç«¯å£ 3000)

# æ•°æ®åº“æ“ä½œ
cd apps/server
bun db:local   # å¯åŠ¨æœ¬åœ° SQLite æ•°æ®åº“
bun db:push    # æ¨é€ schema å˜æ›´
bun db:studio  # æ‰“å¼€æ•°æ®åº“ç®¡ç†ç•Œé¢
```

### æ„å»ºå’Œéƒ¨ç½²

- **æ„å»ºå‘½ä»¤**: `bun build` (Turborepo å¹¶è¡Œæ„å»º)
- **ç±»å‹æ£€æŸ¥**: `bun check-types`
- **éƒ¨ç½²**: ç›®å‰æ²¡æœ‰é…ç½®è‡ªåŠ¨åŒ–éƒ¨ç½²

### ç¯å¢ƒå˜é‡è¦æ±‚

**æœåŠ¡å™¨** (apps/server/.env):
```bash
CORS_ORIGIN=http://localhost:3001
BETTER_AUTH_SECRET=your-secret
BETTER_AUTH_URL=http://localhost:3000
DATABASE_URL=file:local.db
```

**å®¢æˆ·ç«¯** (apps/web/.env):
```bash
VITE_SERVER_URL=http://localhost:3000
```

## åŸºäº PRD çš„å¢å¼ºå½±å“åˆ†æ

### éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

æ ¹æ®ä¸­å›½è‚¡ç¥¨åˆ†æå¹³å°çš„å¢å¼ºéœ€æ±‚ï¼Œä»¥ä¸‹æ–‡ä»¶éœ€è¦ä¿®æ”¹ï¼š

**æ•°æ®åº“ Schema æ‰©å±•**:
- `apps/server/src/db/schema/auth.ts` - æ‰©å±•ç”¨æˆ·è¡¨æ·»åŠ è®¢é˜…å­—æ®µ
- æ–°å¢ `apps/server/src/db/schema/stocks.ts` - è‚¡ç¥¨åŸºç¡€ä¿¡æ¯è¡¨
- æ–°å¢ `apps/server/src/db/schema/finance.ts` - äº¤æ˜“æ•°æ®ã€ç­–ç•¥ã€å›æµ‹è¡¨
- `apps/server/src/db/index.ts` - å¯¼å‡ºæ–°çš„è¡¨ç»“æ„

**API è·¯ç”±æ‰©å±•**:
- `apps/server/src/routers/index.ts` - æ·»åŠ æ–°è·¯ç”±åˆ°ä¸» router
- æ–°å¢ `apps/server/src/routers/stocks.ts` - è‚¡ç¥¨æ•°æ® CRUD API
- æ–°å¢ `apps/server/src/routers/backtest.ts` - å›æµ‹è®¡ç®—å’Œç»“æœ API  
- æ–°å¢ `apps/server/src/routers/ai.ts` - AI åˆ†æ API
- `apps/server/src/lib/context.ts` - å¯èƒ½éœ€è¦æ·»åŠ è®¢é˜…çŠ¶æ€åˆ°ä¸Šä¸‹æ–‡

**ä¸šåŠ¡é€»è¾‘æ¨¡å—**:
- æ–°å¢ `apps/server/src/lib/stock-data.ts` - tushare API é›†æˆ
- æ–°å¢ `apps/server/src/lib/backtest-engine.ts` - å›æµ‹ç®—æ³•å®ç°
- æ–°å¢ `apps/server/src/lib/ai-analysis.ts` - AI æ¨¡å‹é›†æˆ
- æ–°å¢ `apps/server/src/lib/scheduler.ts` - å®šæ—¶ä»»åŠ¡ç®¡ç†

**å‰ç«¯è·¯ç”±å’Œç»„ä»¶**:
- `apps/web/src/routes/dashboard.tsx` - æ‰©å±•ä¸ºè‚¡ç¥¨åˆ†æä¸»æ§å°
- æ–°å¢ `apps/web/src/routes/stocks/` - è‚¡ç¥¨ç›¸å…³é¡µé¢ç›®å½•
  - `index.tsx` - è‚¡ç¥¨æœç´¢åˆ—è¡¨
  - `$stockCode.tsx` - è‚¡ç¥¨è¯¦æƒ…é¡µ
- æ–°å¢ `apps/web/src/routes/backtest/` - å›æµ‹ç›¸å…³é¡µé¢
  - `index.tsx` - ç­–ç•¥ç®¡ç†
  - `$backtestId.tsx` - å›æµ‹ç»“æœé¡µ
- `apps/web/src/components/header.tsx` - æ·»åŠ æ–°çš„å¯¼èˆªé“¾æ¥

**UI ç»„ä»¶æ‰©å±•**:
- æ–°å¢ `apps/web/src/components/stock-chart.tsx` - Kçº¿å›¾ç»„ä»¶
- æ–°å¢ `apps/web/src/components/strategy-builder.tsx` - ç­–ç•¥æ„å»ºå™¨
- æ–°å¢ `apps/web/src/components/backtest-results.tsx` - å›æµ‹ç»“æœå±•ç¤º
- `apps/web/src/components/user-menu.tsx` - æ·»åŠ è®¢é˜…çŠ¶æ€æ˜¾ç¤º

### æ–°å¢æ–‡ä»¶/æ¨¡å—éœ€æ±‚

**æœåŠ¡å™¨ç«¯æ–°å¢**:
```text
apps/server/src/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ stock-data.ts          # tushare API åŒ…è£…å™¨
â”‚   â”œâ”€â”€ backtest-engine.ts     # å›æµ‹æ ¸å¿ƒç®—æ³•
â”‚   â”œâ”€â”€ ai-analysis.ts         # AI åˆ†ææœåŠ¡
â”‚   â””â”€â”€ scheduler.ts           # å®šæ—¶ä»»åŠ¡ç®¡ç†
â”œâ”€â”€ routers/
â”‚   â”œâ”€â”€ stocks.ts              # è‚¡ç¥¨æ•°æ® API
â”‚   â”œâ”€â”€ backtest.ts            # å›æµ‹ API
â”‚   â””â”€â”€ ai.ts                  # AI åˆ†æ API
â””â”€â”€ db/schema/
    â”œâ”€â”€ stocks.ts              # è‚¡ç¥¨ç›¸å…³è¡¨
    â””â”€â”€ finance.ts             # é‡‘èæ•°æ®è¡¨
```

**å®¢æˆ·ç«¯æ–°å¢**:
```text
apps/web/src/
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ stocks/
â”‚   â”‚   â”œâ”€â”€ index.tsx          # è‚¡ç¥¨åˆ—è¡¨é¡µ
â”‚   â”‚   â””â”€â”€ $stockCode.tsx     # è‚¡ç¥¨è¯¦æƒ…é¡µ
â”‚   â””â”€â”€ backtest/
â”‚       â”œâ”€â”€ index.tsx          # ç­–ç•¥ç®¡ç†é¡µ
â”‚       â””â”€â”€ $backtestId.tsx    # å›æµ‹ç»“æœé¡µ
â””â”€â”€ components/
    â”œâ”€â”€ stock-chart.tsx        # Kçº¿å›¾ç»„ä»¶
    â”œâ”€â”€ strategy-builder.tsx   # ç­–ç•¥æ„å»ºå™¨
    â””â”€â”€ backtest-results.tsx   # å›æµ‹ç»“æœç»„ä»¶
```

### é›†æˆè€ƒè™‘äº‹é¡¹

**ä¸ç°æœ‰è®¤è¯ç³»ç»Ÿé›†æˆ**:
- æ‰©å±• Better Auth ç”¨æˆ·æ¨¡å‹æ·»åŠ è®¢é˜…å­—æ®µ
- åœ¨ tRPC ä¸­é—´ä»¶ä¸­æ·»åŠ è®¢é˜…çŠ¶æ€éªŒè¯
- ä¿æŒç°æœ‰ç™»å½•æµç¨‹ä¸å˜

**å“åº”ç°æœ‰å“åº”æ ¼å¼**:
- éµå¾ªå½“å‰ tRPC çš„é”™è¯¯å¤„ç†æ¨¡å¼
- ä¿æŒç±»å‹å®‰å…¨çš„ API å“åº”æ ¼å¼
- ä½¿ç”¨ç°æœ‰çš„ TanStack Query é”™è¯¯å¤„ç†ï¼ˆtoast é€šçŸ¥ï¼‰

**UI ä¸€è‡´æ€§**:
- ä½¿ç”¨ç°æœ‰ shadcn/ui ç»„ä»¶åº“
- ä¿æŒå½“å‰çš„ TailwindCSS ä¸»é¢˜ç³»ç»Ÿ
- éµå¾ªç°æœ‰çš„æ·±è‰²æ¨¡å¼åˆ‡æ¢é€»è¾‘

## é™„å½• - æœ‰ç”¨çš„å‘½ä»¤å’Œè„šæœ¬

### å¸¸ç”¨å‘½ä»¤

```bash
# å¼€å‘
bun dev                 # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼ˆå‰åç«¯å¹¶è¡Œï¼‰
bun build              # æ„å»ºæ‰€æœ‰åº”ç”¨
bun check-types        # ç±»å‹æ£€æŸ¥

# æ•°æ®åº“
bun db:push            # æ¨é€ schema å˜æ›´
bun db:studio          # æ‰“å¼€æ•°æ®åº“ç®¡ç†ç•Œé¢
bun db:generate        # ç”Ÿæˆè¿ç§»æ–‡ä»¶
bun db:migrate         # è¿è¡Œè¿ç§»

# ç‰¹å®šåº”ç”¨
bun dev:web            # ä»…å¯åŠ¨å‰ç«¯
bun dev:server         # ä»…å¯åŠ¨åç«¯
```

### è°ƒè¯•å’Œæ•…éšœæ’é™¤

**æ—¥å¿—**: ä½¿ç”¨ Hono å†…ç½® logger ä¸­é—´ä»¶ï¼Œè¾“å‡ºåˆ°æ§åˆ¶å°
**è°ƒè¯•æ¨¡å¼**: é€šè¿‡æµè§ˆå™¨ DevTools å’Œ TanStack DevTools
**å¸¸è§é—®é¢˜**:
- CORS é…ç½®ï¼šç¡®ä¿ `CORS_ORIGIN` ç¯å¢ƒå˜é‡æ­£ç¡®è®¾ç½®
- è®¤è¯é—®é¢˜ï¼šæ£€æŸ¥ `BETTER_AUTH_SECRET` å’Œ cookie é…ç½®
- æ•°æ®åº“è¿æ¥ï¼šç¡®è®¤ `DATABASE_URL` è·¯å¾„å’Œæƒé™

### å¼€å‘æœ€ä½³å®è·µ

**ç±»å‹å®‰å…¨**:
- æ‰€æœ‰ API è°ƒç”¨éƒ½é€šè¿‡ tRPCï¼Œç¡®ä¿ç±»å‹å®‰å…¨
- ä½¿ç”¨ Zod éªŒè¯å¤–éƒ¨æ•°æ®è¾“å…¥
- ä¸¥æ ¼çš„ TypeScript é…ç½®

**ä»£ç ç»„ç»‡**:
- ä¸šåŠ¡é€»è¾‘æ”¾åœ¨ `lib/` ç›®å½•
- API è·¯ç”±æŒ‰åŠŸèƒ½æ¨¡å—åˆ†ç¦»
- å‰ç«¯ç»„ä»¶æŒ‰ç”¨é€”åˆ†ç±»

**æ€§èƒ½ä¼˜åŒ–**:
- åˆ©ç”¨ Turborepo ç¼“å­˜æœºåˆ¶
- TanStack Query è‡ªåŠ¨ç¼“å­˜å’Œé‡æ–°éªŒè¯
- Vite çš„å¿«é€Ÿçƒ­é‡è½½

---

æ­¤æ–‡æ¡£ä¸º AI ä»£ç†æä¾›äº†å®ç°ä¸­å›½è‚¡ç¥¨åˆ†æå¹³å°å¢å¼ºåŠŸèƒ½æ‰€éœ€çš„å®Œæ•´æ¶æ„ç†è§£ã€‚å…³é”®é‡ç‚¹æ˜¯ä¿æŒä¸ç°æœ‰ç³»ç»Ÿçš„å®Œå…¨å…¼å®¹æ€§ï¼ŒåŒæ—¶é€æ­¥æ‰©å±•åŠŸèƒ½ä»¥æ»¡è¶³ PRD è¦æ±‚ã€‚