# æ— éšœç¢æ€§å®æ–½å’Œæµ‹è¯•è§„èŒƒ

## 1. æ— éšœç¢æ€§æ ‡å‡†å’Œç›®æ ‡

### 1.1 åˆè§„ç›®æ ‡
```typescript
// apps/web/src/lib/accessibility-standards.ts
export const ACCESSIBILITY_COMPLIANCE = {
  target: 'WCAG 2.1 AA',
  framework: 'Web Content Accessibility Guidelines',
  level: 'AA',
  version: '2.1',
  testingStandard: 'EN 301 549',
  complianceDate: '2025-12-31',
  auditFrequency: 'quarterly'
} as const

export const WCAG_SUCCESS_CRITERIA = {
  // Level A æ ‡å‡†
  LEVEL_A: [
    '1.1.1', // Non-text Content
    '1.2.1', // Audio-only and Video-only (Prerecorded)
    '1.2.2', // Captions (Prerecorded)
    '1.2.3', // Audio Description or Media Alternative
    '1.3.1', // Info and Relationships
    '1.3.2', // Meaningful Sequence
    '1.3.3', // Sensory Characteristics
    '1.4.1', // Use of Color
    '1.4.2', // Audio Control
    '2.1.1', // Keyboard
    '2.1.2', // No Keyboard Trap
    '2.1.4', // Character Key Shortcuts
    '2.2.1', // Timing Adjustable
    '2.2.2', // Pause, Stop, Hide
    '2.3.1', // Three Flashes or Below Threshold
    '2.4.1', // Bypass Blocks
    '2.4.2', // Page Titled
    '2.4.3', // Focus Order
    '2.4.4', // Link Purpose (In Context)
    '3.1.1', // Language of Page
    '3.2.1', // On Focus
    '3.2.2', // On Input
    '3.3.1', // Error Identification
    '3.3.2', // Labels or Instructions
    '4.1.1', // Parsing
    '4.1.2'  // Name, Role, Value
  ],
  // Level AA æ ‡å‡†
  LEVEL_AA: [
    '1.2.4', // Captions (Live)
    '1.2.5', // Audio Description (Prerecorded)
    '1.3.4', // Orientation
    '1.3.5', // Identify Input Purpose
    '1.4.3', // Contrast (Minimum)
    '1.4.4', // Resize Text
    '1.4.5', // Images of Text
    '1.4.10', // Reflow
    '1.4.11', // Non-text Contrast
    '1.4.12', // Text Spacing
    '1.4.13', // Content on Hover or Focus
    '2.4.5', // Multiple Ways
    '2.4.6', // Headings and Labels
    '2.4.7', // Focus Visible
    '2.5.1', // Pointer Gestures
    '2.5.2', // Pointer Cancellation
    '2.5.3', // Label in Name
    '2.5.4', // Motion Actuation
    '3.1.2', // Language of Parts
    '3.2.3', // Consistent Navigation
    '3.2.4', // Consistent Identification
    '3.3.3', // Error Suggestion
    '3.3.4', // Error Prevention (Legal, Financial, Data)
    '4.1.3'  // Status Messages
  ]
}
```

### 1.2 è‚¡ç¥¨åº”ç”¨ç‰¹å®šæ— éšœç¢è¦æ±‚
```typescript
// apps/web/src/lib/financial-accessibility.ts
export const FINANCIAL_ACCESSIBILITY_REQUIREMENTS = {
  // è‚¡ç¥¨æ•°æ®è¡¨æ ¼
  DATA_TABLES: {
    requirement: 'æ‰€æœ‰è‚¡ç¥¨æ•°æ®è¡¨æ ¼å¿…é¡»æœ‰è¡¨å¤´ã€è¯´æ˜å’Œæ’åºåŠŸèƒ½',
    wcagCriteria: ['1.3.1', '2.4.6', '4.1.2'],
    implementation: 'tableå…ƒç´  + scopeå±æ€§ + sortable ARIA'
  },
  
  // å›¾è¡¨å¯è®¿é—®æ€§
  CHARTS: {
    requirement: 'è‚¡ç¥¨å›¾è¡¨å¿…é¡»æä¾›æ›¿ä»£æ–‡æœ¬æè¿°å’Œæ•°æ®è¡¨æ ¼',
    wcagCriteria: ['1.1.1', '1.3.1'],
    implementation: 'altå±æ€§ + longdesc + æ•°æ®è¡¨æ ¼å›é€€'
  },
  
  // ä»·æ ¼å˜åŒ–æŒ‡ç¤º
  PRICE_CHANGES: {
    requirement: 'ä»·æ ¼æ¶¨è·Œä¸èƒ½ä»…ä¾èµ–é¢œè‰²ï¼Œå¿…é¡»æœ‰æ–‡æœ¬æˆ–å›¾æ ‡æŒ‡ç¤º',
    wcagCriteria: ['1.4.1'],
    implementation: 'å›¾æ ‡ + æ–‡æœ¬æ ‡ç­¾ï¼ˆå¦‚ "ä¸Šæ¶¨ +2.5%"ï¼‰'
  },
  
  // å®æ—¶æ•°æ®æ›´æ–°
  LIVE_UPDATES: {
    requirement: 'å®æ—¶ä»·æ ¼æ›´æ–°å¿…é¡»é€šè¿‡å±å¹•é˜…è¯»å™¨æ’­æŠ¥',
    wcagCriteria: ['4.1.3'],
    implementation: 'aria-live="polite" + role="status"'
  },
  
  // é”®ç›˜å¯¼èˆª
  KEYBOARD_NAVIGATION: {
    requirement: 'æ‰€æœ‰äº¤äº’åŠŸèƒ½å¿…é¡»æ”¯æŒé”®ç›˜æ“ä½œ',
    wcagCriteria: ['2.1.1', '2.1.2', '2.4.3'],
    implementation: 'tabindex + focusç®¡ç† + é”®ç›˜äº‹ä»¶å¤„ç†'
  }
} as const
```

## 2. æ— éšœç¢ç»„ä»¶å®æ–½

### 2.1 è‚¡ç¥¨æ•°æ®è¡¨æ ¼ç»„ä»¶
```typescript
// apps/web/src/components/accessibility/accessible-stock-table.tsx
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table'
import { ArrowUpIcon, ArrowDownIcon, MinusIcon } from 'lucide-react'

interface StockData {
  symbol: string
  name: string
  price: number
  change: number
  changePercent: number
}

interface AccessibleStockTableProps {
  data: StockData[]
  caption: string
}

export const AccessibleStockTable = ({ data, caption }: AccessibleStockTableProps) => {
  const formatPriceChange = (change: number, percent: number) => {
    const direction = change > 0 ? 'ä¸Šæ¶¨' : change < 0 ? 'ä¸‹è·Œ' : 'æŒå¹³'
    const icon = change > 0 ? <ArrowUpIcon /> : change < 0 ? <ArrowDownIcon /> : <MinusIcon />
    const changeText = `${direction} ${Math.abs(change).toFixed(2)} (${Math.abs(percent).toFixed(2)}%)`
    
    return (
      <span className={`flex items-center gap-1 ${
        change > 0 ? 'text-green-600' : change < 0 ? 'text-red-600' : 'text-gray-600'
      }`}>
        {icon}
        <span className="sr-only">{changeText}</span>
        <span aria-hidden="true">{change.toFixed(2)} ({percent.toFixed(2)}%)</span>
      </span>
    )
  }

  return (
    <div role="region" aria-label="è‚¡ç¥¨æ•°æ®è¡¨æ ¼">
      <Table>
        <caption className="sr-only">{caption}</caption>
        <TableHeader>
          <TableRow>
            <TableHead scope="col" id="symbol-header">
              è‚¡ç¥¨ä»£ç 
              <span className="sr-only">æŒ‰è‚¡ç¥¨ä»£ç æ’åº</span>
            </TableHead>
            <TableHead scope="col" id="name-header">
              è‚¡ç¥¨åç§°
            </TableHead>
            <TableHead scope="col" id="price-header" className="text-right">
              å½“å‰ä»·æ ¼ï¼ˆå…ƒï¼‰
            </TableHead>
            <TableHead scope="col" id="change-header" className="text-right">
              æ¶¨è·Œå¹…
              <span className="sr-only">åŒ…å«æ¶¨è·Œé‡‘é¢å’Œç™¾åˆ†æ¯”</span>
            </TableHead>
          </TableRow>
        </TableHeader>
        <TableBody>
          {data.map((stock) => (
            <TableRow key={stock.symbol}>
              <TableCell headers="symbol-header">
                <strong>{stock.symbol}</strong>
              </TableCell>
              <TableCell headers="name-header">
                {stock.name}
              </TableCell>
              <TableCell headers="price-header" className="text-right font-mono">
                Â¥{stock.price.toFixed(2)}
              </TableCell>
              <TableCell headers="change-header" className="text-right">
                {formatPriceChange(stock.change, stock.changePercent)}
              </TableCell>
            </TableRow>
          ))}
        </TableBody>
      </Table>
    </div>
  )
}
```

### 2.2 å®æ—¶ä»·æ ¼æ›´æ–°ç»„ä»¶
```typescript
// apps/web/src/components/accessibility/live-price-announcer.tsx
import { useEffect, useRef } from 'react'

interface LivePriceAnnouncerProps {
  symbol: string
  price: number
  change: number
  announceInterval?: number // æ’­æŠ¥é—´éš”ï¼ˆæ¯«ç§’ï¼‰
}

export const LivePriceAnnouncer = ({ 
  symbol, 
  price, 
  change, 
  announceInterval = 30000 // é»˜è®¤30ç§’æ’­æŠ¥ä¸€æ¬¡
}: LivePriceAnnouncerProps) => {
  const lastAnnouncedRef = useRef<number>(0)
  const statusRef = useRef<HTMLDivElement>(null)

  useEffect(() => {
    const now = Date.now()
    if (now - lastAnnouncedRef.current >= announceInterval) {
      const direction = change > 0 ? 'ä¸Šæ¶¨' : change < 0 ? 'ä¸‹è·Œ' : 'æŒå¹³'
      const announcement = `${symbol} å½“å‰ä»·æ ¼ ${price.toFixed(2)} å…ƒï¼Œ${direction} ${Math.abs(change).toFixed(2)} å…ƒ`
      
      if (statusRef.current) {
        statusRef.current.textContent = announcement
        lastAnnouncedRef.current = now
      }
    }
  }, [symbol, price, change, announceInterval])

  return (
    <div
      ref={statusRef}
      role="status"
      aria-live="polite"
      aria-atomic="true"
      className="sr-only"
    />
  )
}
```

### 2.3 å›¾è¡¨å¯è®¿é—®æ€§ç»„ä»¶
```typescript
// apps/web/src/components/accessibility/accessible-chart.tsx
import { useState } from 'react'
import { Button } from '@/components/ui/button'
import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from '@/components/ui/table'

interface ChartDataPoint {
  date: string
  value: number
  label?: string
}

interface AccessibleChartProps {
  title: string
  description: string
  data: ChartDataPoint[]
  chartComponent: React.ReactNode
}

export const AccessibleChart = ({ title, description, data, chartComponent }: AccessibleChartProps) => {
  const [showDataTable, setShowDataTable] = useState(false)

  const generateSummary = () => {
    if (data.length === 0) return 'æ— æ•°æ®'
    
    const values = data.map(d => d.value)
    const min = Math.min(...values)
    const max = Math.max(...values)
    const latest = values[values.length - 1]
    const trend = values.length > 1 ? 
      (latest > values[values.length - 2] ? 'ä¸Šå‡' : latest < values[values.length - 2] ? 'ä¸‹é™' : 'æŒå¹³') 
      : 'æ— è¶‹åŠ¿æ•°æ®'
    
    return `æ•°æ®èŒƒå›´ä» ${min.toFixed(2)} åˆ° ${max.toFixed(2)}ï¼Œæœ€æ–°å€¼ ${latest.toFixed(2)}ï¼Œè¶‹åŠ¿ ${trend}ã€‚å…± ${data.length} ä¸ªæ•°æ®ç‚¹ã€‚`
  }

  return (
    <div className="space-y-4">
      {/* å›¾è¡¨æ ‡é¢˜å’Œæè¿° */}
      <div>
        <h3 id={`chart-${title.replace(/\s+/g, '-').toLowerCase()}`} className="text-lg font-semibold">
          {title}
        </h3>
        <p className="text-sm text-muted-foreground mt-1">
          {description}
        </p>
        <p className="text-sm text-muted-foreground mt-1" aria-label="å›¾è¡¨æ•°æ®æ‘˜è¦">
          {generateSummary()}
        </p>
      </div>

      {/* å›¾è¡¨å®¹å™¨ */}
      <div 
        role="img"
        aria-labelledby={`chart-${title.replace(/\s+/g, '-').toLowerCase()}`}
        aria-describedby={`chart-summary-${title.replace(/\s+/g, '-').toLowerCase()}`}
      >
        {chartComponent}
      </div>

      {/* æ•°æ®è¡¨æ ¼åˆ‡æ¢æŒ‰é’® */}
      <div className="flex gap-2">
        <Button
          variant="outline"
          size="sm"
          onClick={() => setShowDataTable(!showDataTable)}
          aria-expanded={showDataTable}
          aria-controls={`chart-data-table-${title.replace(/\s+/g, '-').toLowerCase()}`}
        >
          {showDataTable ? 'éšè—æ•°æ®è¡¨æ ¼' : 'æ˜¾ç¤ºæ•°æ®è¡¨æ ¼'}
        </Button>
      </div>

      {/* æ•°æ®è¡¨æ ¼ï¼ˆå¯é€‰æ˜¾ç¤ºï¼‰ */}
      {showDataTable && (
        <div 
          id={`chart-data-table-${title.replace(/\s+/g, '-').toLowerCase()}`}
          role="region"
          aria-label={`${title} æ•°æ®è¡¨æ ¼`}
        >
          <Table>
            <caption className="sr-only">
              {title} çš„è¯¦ç»†æ•°æ®ï¼ŒåŒ…å«æ—¥æœŸå’Œæ•°å€¼
            </caption>
            <TableHeader>
              <TableRow>
                <TableHead scope="col">æ—¥æœŸ</TableHead>
                <TableHead scope="col" className="text-right">æ•°å€¼</TableHead>
                {data.some(d => d.label) && (
                  <TableHead scope="col">è¯´æ˜</TableHead>
                )}
              </TableRow>
            </TableHeader>
            <TableBody>
              {data.map((point, index) => (
                <TableRow key={`${point.date}-${index}`}>
                  <TableCell>{point.date}</TableCell>
                  <TableCell className="text-right font-mono">
                    {point.value.toFixed(2)}
                  </TableCell>
                  {data.some(d => d.label) && (
                    <TableCell>{point.label || ''}</TableCell>
                  )}
                </TableRow>
              ))}
            </TableBody>
          </Table>
        </div>
      )}

      {/* éšè—çš„æ‘˜è¦ç”¨äºå±å¹•é˜…è¯»å™¨ */}
      <div 
        id={`chart-summary-${title.replace(/\s+/g, '-').toLowerCase()}`}
        className="sr-only"
      >
        {generateSummary()}
      </div>
    </div>
  )
}
```

## 3. æ— éšœç¢æ€§æµ‹è¯•å·¥å…·å’Œæµç¨‹

### 3.1 è‡ªåŠ¨åŒ–æµ‹è¯•é…ç½®
```typescript
// apps/web/src/tests/accessibility.config.ts
export const ACCESSIBILITY_TESTING_CONFIG = {
  tools: {
    axeCore: {
      version: '^4.8.0',
      rules: {
        // å¯ç”¨æ‰€æœ‰ WCAG 2.1 AA è§„åˆ™
        'wcag2a': { enabled: true },
        'wcag2aa': { enabled: true },
        'wcag21aa': { enabled: true },
        // è‚¡ç¥¨åº”ç”¨ç‰¹å®šè§„åˆ™
        'color-contrast': { enabled: true },
        'keyboard-navigation': { enabled: true },
        'focus-order-semantics': { enabled: true }
      }
    },
    lighthouse: {
      accessibility: {
        threshold: 95, // æœ€ä½95åˆ†
        categories: ['accessibility']
      }
    },
    playwright: {
      accessibility: {
        include: ['wcag2a', 'wcag2aa', 'wcag21aa'],
        exclude: [] // æš‚æ— æ’é™¤è§„åˆ™
      }
    }
  },
  testEnvironments: ['desktop', 'mobile', 'tablet'],
  screenReaders: ['nvda', 'jaws', 'voiceover'],
  browsers: ['chrome', 'firefox', 'safari', 'edge']
}
```

### 3.2 Playwright æ— éšœç¢æ€§æµ‹è¯•
```typescript
// tests/e2e/accessibility.spec.ts
import { test, expect } from '@playwright/test'
import AxeBuilder from '@axe-core/playwright'

test.describe('æ— éšœç¢æ€§æµ‹è¯•', () => {
  test('é¦–é¡µæ— éšœç¢æ€§åˆè§„', async ({ page }) => {
    await page.goto('/')
    
    const accessibilityScanResults = await new AxeBuilder({ page })
      .withTags(['wcag2a', 'wcag2aa', 'wcag21aa'])
      .analyze()

    expect(accessibilityScanResults.violations).toEqual([])
  })

  test('è‚¡ç¥¨åˆ—è¡¨é¡µé¢æ— éšœç¢æ€§', async ({ page }) => {
    await page.goto('/stocks')
    
    // æ£€æŸ¥è¡¨æ ¼å¯è®¿é—®æ€§
    const table = page.locator('table').first()
    await expect(table).toHaveAttribute('role', 'table')
    
    // æ£€æŸ¥è¡¨å¤´
    const headers = page.locator('th')
    for (const header of await headers.all()) {
      await expect(header).toHaveAttribute('scope', 'col')
    }

    // è¿è¡Œ axe æµ‹è¯•
    const accessibilityScanResults = await new AxeBuilder({ page })
      .withTags(['wcag2a', 'wcag2aa', 'wcag21aa'])
      .analyze()

    expect(accessibilityScanResults.violations).toEqual([])
  })

  test('é”®ç›˜å¯¼èˆªæµ‹è¯•', async ({ page }) => {
    await page.goto('/stocks')
    
    // æµ‹è¯• Tab å¯¼èˆª
    await page.keyboard.press('Tab')
    const focusedElement = page.locator(':focus')
    await expect(focusedElement).toBeVisible()

    // æµ‹è¯•æ˜¯å¦å¯ä»¥é€šè¿‡é”®ç›˜è®¿é—®æ‰€æœ‰äº¤äº’å…ƒç´ 
    const interactiveElements = page.locator('button, a, input, select, textarea, [tabindex="0"]')
    const count = await interactiveElements.count()
    
    for (let i = 0; i < count; i++) {
      await page.keyboard.press('Tab')
      const focused = page.locator(':focus')
      await expect(focused).toBeVisible()
    }
  })

  test('å±å¹•é˜…è¯»å™¨å…¼å®¹æ€§æµ‹è¯•', async ({ page }) => {
    await page.goto('/stocks')
    
    // æ£€æŸ¥ ARIA æ ‡ç­¾
    const liveRegions = page.locator('[aria-live]')
    for (const region of await liveRegions.all()) {
      const ariaLive = await region.getAttribute('aria-live')
      expect(['polite', 'assertive', 'off']).toContain(ariaLive)
    }

    // æ£€æŸ¥è¯­ä¹‰åŒ–æ ‡è®°
    await expect(page.locator('main')).toBeVisible()
    await expect(page.locator('nav')).toBeVisible()
    
    // æ£€æŸ¥æ ‡é¢˜å±‚æ¬¡ç»“æ„
    const headings = page.locator('h1, h2, h3, h4, h5, h6')
    const headingTexts = await headings.allTextContents()
    expect(headingTexts.length).toBeGreaterThan(0)
  })

  test('å¯¹æ¯”åº¦æµ‹è¯•', async ({ page }) => {
    await page.goto('/')
    
    const accessibilityScanResults = await new AxeBuilder({ page })
      .withRules(['color-contrast'])
      .analyze()

    expect(accessibilityScanResults.violations).toEqual([])
  })
})
```

### 3.3 æ‰‹åŠ¨æµ‹è¯•æ£€æŸ¥æ¸…å•
```typescript
// tests/manual/accessibility-checklist.ts
export const MANUAL_ACCESSIBILITY_CHECKLIST = {
  // é”®ç›˜å¯¼èˆªæµ‹è¯•
  KEYBOARD_NAVIGATION: [
    {
      test: 'ä½¿ç”¨ Tab é”®å¯¼èˆªæ‰€æœ‰äº¤äº’å…ƒç´ ',
      pass: 'æ‰€æœ‰æŒ‰é’®ã€é“¾æ¥ã€è¡¨å•æ§ä»¶å¯ä»¥é€šè¿‡ Tab é”®è®¿é—®',
      fail: 'æŸäº›äº¤äº’å…ƒç´ æ— æ³•é€šè¿‡é”®ç›˜è®¿é—®'
    },
    {
      test: 'ä½¿ç”¨ Shift+Tab åå‘å¯¼èˆª',
      pass: 'å¯ä»¥æ­£ç¡®åå‘å¯¼èˆª',
      fail: 'åå‘å¯¼èˆªé¡ºåºé”™è¯¯æˆ–è¢«å›°'
    },
    {
      test: 'ä½¿ç”¨ Enter/Space æ¿€æ´»æ§ä»¶',
      pass: 'æ‰€æœ‰å¯æ¿€æ´»å…ƒç´ å“åº”é”®ç›˜æ¿€æ´»',
      fail: 'æŸäº›å…ƒç´ æ— æ³•é€šè¿‡é”®ç›˜æ¿€æ´»'
    },
    {
      test: 'ä½¿ç”¨ç®­å¤´é”®å¯¼èˆªèœå•å’Œåˆ—è¡¨',
      pass: 'å¤æ‚æ§ä»¶æ”¯æŒç®­å¤´é”®å¯¼èˆª',
      fail: 'å¤æ‚æ§ä»¶ç¼ºå°‘ç®­å¤´é”®æ”¯æŒ'
    }
  ],

  // å±å¹•é˜…è¯»å™¨æµ‹è¯•
  SCREEN_READER: [
    {
      test: 'ä½¿ç”¨ NVDA æµ‹è¯•ä¸»è¦åŠŸèƒ½',
      pass: 'æ‰€æœ‰å†…å®¹è¢«æ­£ç¡®æœ—è¯»ï¼Œå¯¼èˆªæ¸…æ™°',
      fail: 'å†…å®¹æ— æ³•æœ—è¯»æˆ–å¯¼èˆªæ··ä¹±'
    },
    {
      test: 'æµ‹è¯•å®æ—¶æ›´æ–°æ’­æŠ¥',
      pass: 'ä»·æ ¼å˜åŒ–å’ŒçŠ¶æ€æ›´æ–°è¢«åŠæ—¶æ’­æŠ¥',
      fail: 'å®æ—¶æ›´æ–°æœªè¢«æ’­æŠ¥'
    },
    {
      test: 'æµ‹è¯•è¡¨æ ¼å’Œå›¾è¡¨æè¿°',
      pass: 'å¤æ‚å†…å®¹æœ‰æ¸…æ™°çš„æ›¿ä»£æè¿°',
      fail: 'å¤æ‚å†…å®¹ç¼ºå°‘æ›¿ä»£æè¿°'
    }
  ],

  // è§†è§‰æµ‹è¯•
  VISUAL: [
    {
      test: '200% ç¼©æ”¾æµ‹è¯•',
      pass: 'åœ¨ 200% ç¼©æ”¾ä¸‹æ‰€æœ‰å†…å®¹å¯ç”¨',
      fail: 'ç¼©æ”¾åå†…å®¹è¢«æˆªæ–­æˆ–é‡å '
    },
    {
      test: 'é«˜å¯¹æ¯”åº¦æ¨¡å¼æµ‹è¯•',
      pass: 'åœ¨é«˜å¯¹æ¯”åº¦æ¨¡å¼ä¸‹å†…å®¹æ¸…æ™°å¯è§',
      fail: 'é«˜å¯¹æ¯”åº¦æ¨¡å¼ä¸‹å†…å®¹ä¸å¯è§'
    },
    {
      test: 'è‰²ç›²å‹å¥½æµ‹è¯•',
      pass: 'ä¸ä¾èµ–é¢œè‰²ä¼ è¾¾é‡è¦ä¿¡æ¯',
      fail: 'é‡è¦ä¿¡æ¯ä»…é€šè¿‡é¢œè‰²è¡¨è¾¾'
    }
  ]
}
```

## 4. æµ‹è¯•æ‰§è¡Œæµç¨‹

### 4.1 CI/CD é›†æˆ
```yaml
# .github/workflows/accessibility.yml
name: Accessibility Testing

on:
  pull_request:
    paths:
      - 'apps/web/**'
  push:
    branches: [main]

jobs:
  accessibility-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Bun
        uses: oven-sh/setup-bun@v1
        with:
          bun-version: 1.2.18

      - name: Install dependencies
        run: bun install

      - name: Build application
        run: bun run build

      - name: Run Lighthouse CI
        run: |
          npm install -g @lhci/cli@0.12.x
          lhci autorun
        env:
          LHCI_GITHUB_APP_TOKEN: ${{ secrets.LHCI_GITHUB_APP_TOKEN }}

      - name: Run axe-core tests
        run: bun run test:accessibility

      - name: Run Playwright accessibility tests
        run: bun run test:e2e:accessibility

      - name: Generate accessibility report
        run: bun run accessibility:report

      - name: Upload accessibility report
        uses: actions/upload-artifact@v3
        with:
          name: accessibility-report
          path: accessibility-report/
```

### 4.2 æŠ¥å‘Šç”Ÿæˆ
```typescript
// scripts/generate-accessibility-report.ts
import fs from 'fs'
import path from 'path'

interface AccessibilityTestResult {
  tool: string
  score: number
  violations: any[]
  timestamp: string
  url: string
}

export class AccessibilityReportGenerator {
  static async generateReport(results: AccessibilityTestResult[]): Promise<void> {
    const reportDir = path.join(process.cwd(), 'accessibility-report')
    
    if (!fs.existsSync(reportDir)) {
      fs.mkdirSync(reportDir, { recursive: true })
    }

    // ç”Ÿæˆ HTML æŠ¥å‘Š
    const htmlReport = this.generateHTMLReport(results)
    fs.writeFileSync(path.join(reportDir, 'index.html'), htmlReport)

    // ç”Ÿæˆ JSON æ•°æ®
    fs.writeFileSync(
      path.join(reportDir, 'results.json'), 
      JSON.stringify(results, null, 2)
    )

    // ç”Ÿæˆ CSV æ‘˜è¦
    const csvSummary = this.generateCSVSummary(results)
    fs.writeFileSync(path.join(reportDir, 'summary.csv'), csvSummary)

    console.log(`æ— éšœç¢æ€§æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: ${reportDir}`)
  }

  private static generateHTMLReport(results: AccessibilityTestResult[]): string {
    const overallScore = results.reduce((sum, r) => sum + r.score, 0) / results.length
    const totalViolations = results.reduce((sum, r) => sum + r.violations.length, 0)

    return `
    <!DOCTYPE html>
    <html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>neostock æ— éšœç¢æ€§æµ‹è¯•æŠ¥å‘Š</title>
        <style>
            body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; margin: 0; padding: 20px; }
            .header { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
            .score { font-size: 2rem; font-weight: bold; color: ${overallScore >= 95 ? '#22c55e' : overallScore >= 80 ? '#f59e0b' : '#ef4444'}; }
            .violations { background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 16px; margin: 16px 0; }
            .violation-item { margin-bottom: 12px; padding: 12px; background: white; border-radius: 4px; }
            .pass { background: #f0fdf4; border: 1px solid #bbf7d0; }
            table { width: 100%; border-collapse: collapse; margin: 20px 0; }
            th, td { border: 1px solid #e5e7eb; padding: 12px; text-align: left; }
            th { background: #f9fafb; font-weight: 600; }
        </style>
    </head>
    <body>
        <div class="header">
            <h1>neostock æ— éšœç¢æ€§æµ‹è¯•æŠ¥å‘Š</h1>
            <p>ç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString('zh-CN')}</p>
            <div class="score">æ•´ä½“è¯„åˆ†: ${overallScore.toFixed(1)}/100</div>
            <p>æ€»è¿è§„æ•°: ${totalViolations}</p>
        </div>

        <h2>æµ‹è¯•ç»“æœæ‘˜è¦</h2>
        <table>
            <thead>
                <tr>
                    <th>æµ‹è¯•å·¥å…·</th>
                    <th>æµ‹è¯•URL</th>
                    <th>è¯„åˆ†</th>
                    <th>è¿è§„æ•°</th>
                    <th>çŠ¶æ€</th>
                </tr>
            </thead>
            <tbody>
                ${results.map(result => `
                    <tr>
                        <td>${result.tool}</td>
                        <td>${result.url}</td>
                        <td>${result.score}</td>
                        <td>${result.violations.length}</td>
                        <td class="${result.violations.length === 0 ? 'pass' : 'violations'}">
                            ${result.violations.length === 0 ? 'âœ… é€šè¿‡' : 'âŒ æœ‰é—®é¢˜'}
                        </td>
                    </tr>
                `).join('')}
            </tbody>
        </table>

        ${totalViolations > 0 ? `
        <h2>é—®é¢˜è¯¦æƒ…</h2>
        ${results.filter(r => r.violations.length > 0).map(result => `
            <div class="violations">
                <h3>${result.tool} - ${result.url}</h3>
                ${result.violations.map(violation => `
                    <div class="violation-item">
                        <strong>${violation.id}</strong>: ${violation.description}
                        <br><small>å½±å“: ${violation.impact} | æ ‡å‡†: ${violation.tags?.join(', ')}</small>
                    </div>
                `).join('')}
            </div>
        `).join('')} ` : '<div class="pass"><h2>ğŸ‰ æ‰€æœ‰æµ‹è¯•éƒ½é€šè¿‡äº†ï¼</h2></div>'}
    </body>
    </html>
    `
  }

  private static generateCSVSummary(results: AccessibilityTestResult[]): string {
    const headers = ['å·¥å…·', 'URL', 'è¯„åˆ†', 'è¿è§„æ•°', 'æ—¶é—´æˆ³']
    const rows = results.map(r => [
      r.tool,
      r.url,
      r.score.toString(),
      r.violations.length.toString(),
      r.timestamp
    ])

    return [headers, ...rows].map(row => row.join(',')).join('\n')
  }
}
```

## 5. æŒç»­æ”¹è¿›æµç¨‹

### 5.1 å®šæœŸå®¡è®¡è®¡åˆ’
```typescript
// scripts/accessibility-audit-schedule.ts
export const ACCESSIBILITY_AUDIT_SCHEDULE = {
  frequency: 'quarterly',
  nextAudit: '2025-03-31',
  scope: [
    'complete_user_journey_audit',
    'screen_reader_compatibility_test',
    'keyboard_navigation_audit',
    'wcag_compliance_verification'
  ],
  tools: [
    'axe-core',
    'lighthouse',
    'wave',
    'manual_testing'
  ],
  stakeholders: [
    'frontend_team',
    'ux_team',
    'qa_team',
    'accessibility_consultant'
  ]
}
```

### 5.2 åŸ¹è®­å’Œæ–‡æ¡£
```typescript
// docs/accessibility-training.md
export const ACCESSIBILITY_TRAINING_PROGRAM = {
  required_training: [
    {
      topic: 'WCAG 2.1 åŸºç¡€',
      duration: '4å°æ—¶',
      frequency: 'annually',
      target: 'all_developers'
    },
    {
      topic: 'å±å¹•é˜…è¯»å™¨ä½¿ç”¨',
      duration: '2å°æ—¶',
      frequency: 'annually', 
      target: 'frontend_developers'
    },
    {
      topic: 'æ— éšœç¢æ€§æµ‹è¯•å·¥å…·',
      duration: '3å°æ—¶',
      frequency: 'annually',
      target: 'qa_team'
    }
  ],
  resources: [
    'WCAG 2.1 å¿«é€Ÿå‚è€ƒæŒ‡å—',
    'axe-core æµ‹è¯•æŒ‡å—',
    'é”®ç›˜å¯¼èˆªæµ‹è¯•æ¸…å•',
    'å±å¹•é˜…è¯»å™¨æµ‹è¯•æŒ‡å—'
  ]
}
```

## 6. å®æ–½æ£€æŸ¥æ¸…å•

### 6.1 å¼€å‘é˜¶æ®µ
- [ ] å®ç°æ— éšœç¢ç»„ä»¶åº“
- [ ] é…ç½®è‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·
- [ ] å»ºç«‹æµ‹è¯•æµç¨‹
- [ ] åˆ›å»ºæ‰‹åŠ¨æµ‹è¯•æ¸…å•
- [ ] é›†æˆ CI/CD æµ‹è¯•

### 6.2 æµ‹è¯•é˜¶æ®µ
- [ ] è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶
- [ ] æ‰§è¡Œæ‰‹åŠ¨é”®ç›˜å¯¼èˆªæµ‹è¯•
- [ ] è¿›è¡Œå±å¹•é˜…è¯»å™¨æµ‹è¯•
- [ ] éªŒè¯è‰²å½©å¯¹æ¯”åº¦
- [ ] æµ‹è¯•ç§»åŠ¨ç«¯æ— éšœç¢æ€§

### 6.3 éƒ¨ç½²é˜¶æ®µ
- [ ] ç”Ÿäº§ç¯å¢ƒæ— éšœç¢æ€§éªŒè¯
- [ ] ç”¨æˆ·åé¦ˆæ”¶é›†æœºåˆ¶
- [ ] æŒç»­ç›‘æ§è®¾ç½®
- [ ] å®šæœŸå®¡è®¡è®¡åˆ’
- [ ] æ–‡æ¡£å’ŒåŸ¹è®­æ›´æ–°

## 7. åˆè§„æ€§è®¤è¯ç›®æ ‡

| æ ‡å‡† | çº§åˆ« | ç›®æ ‡æ—¥æœŸ | å½“å‰çŠ¶æ€ | è´Ÿè´£äºº |
|------|------|----------|----------|--------|
| WCAG 2.1 | AA | 2025-12-31 | ğŸŸ¡ å®æ–½ä¸­ | å‰ç«¯å›¢é˜Ÿ |
| EN 301 549 | - | 2026-06-30 | ğŸŸ¡ è§„åˆ’ä¸­ | UXå›¢é˜Ÿ |
| Section 508 | - | 2026-12-31 | ğŸŸ¡ è§„åˆ’ä¸­ | åˆè§„å›¢é˜Ÿ |
| ä¸­å›½ä¿¡æ¯æ— éšœç¢æ ‡å‡† | - | 2025-12-31 | ğŸŸ¡ è§„åˆ’ä¸­ | äº§å“å›¢é˜Ÿ |